<!-- photo, modified after https://github.com/baltpeter/benjamin-altpeter.de/blob/master/site/layouts/shortcodes/img.html -->
<figure {{ with .Get "class" }}class="{{.}}"{{ end }}>
{{ with .Get "link"}}<a href="{{.}}">{{ end }}
    <img src="
{{- if .Site.Params.useCdn -}}
    {{- delimit (slice .Site.Params.cdnBaseUrl "/large/" (.Get "filename")) "" -}}
{{- else -}}
    {{- delimit (slice .Site.Params.s3BaseUrl "/large/" (.Get "filename")) "" -}}
{{- end -}}
" {{ if or (.Get "alt") (.Get "caption") }}alt="{{ with .Get "alt"}}{{.}}{{else}}{{ .Get "caption" }}{{ end }}" title="{{ with .Get "alt"}}{{.}}{{else}}{{ .Get "caption" }}{{ end }}"{{ end }} />
    {{ if .Get "link"}}</a>{{ end }}
{{ if or (or (.Get "title") (.Get "caption")) (.Get "attr")}}
<figcaption>{{ if isset .Params "caption" }}{{ .Get "caption" }}{{ end }}</figcaption>
{{ end }}
</figure>
<!-- photo -->
